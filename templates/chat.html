{% extends "layout.html" %}
{% block title %}Chat{% endblock %}

{% block main %}
<div class="container-fluid">
    <div class="row">

        <!-- Left column (users)-->
        <div id="user-list" class="col-3 border-end">
            <h5>Users</h5>
            <!-- List of users -->
             <ul class="list-group">
                {% for user, last_message_time in recent_users %}
                    <li class="list-group-item">
                        <a href="/chat?recipient_id={{ user.id }}"
                        class="text-decoration-none {{ 'active' if user.id == recipient_id }}">
                            {{ user.username}}
                        </a>
                    </li>
                {% endfor %}
            </ul>

            <!-- Add new user -->
             <form action="/chat/start" method="post" class="mt-3">
                <div class="input-group">
                    <input type="text" name="username" class="form-control" placeholder="Enter username..." required>
                    <button type="submit" class="btn btn-primary">Add</button>
                </div>
            </form>
        </div>


        <!-- Right column (chat)-->
        <div class="col-9">
            {% if recipient %}
            <h5>Chat with {{ recipient.username }}</h5>
            <!-- Chat -->
            <div id="chat-box">
                {% for message in messages %}
                <div class="mb-2">
                    <strong>{{ 'You' if message.user_id == session['user_id'] else message.sender.username }}: </strong>
                    {{ message.text }}
                    <small class="text-muted">{{ message.timestamp.strftime('%Y-%m-%d %H:%M') }}</small>
                    <!--
                    <span class="username me-2">{{ 'You' if message.user_id == session['user_id'] else message.sender.username }}: </span>
                    <span class="message-text">{{ message.text }}</span>
                    <small class="text-muted">{{ message.timestamp.strftime('%Y-%m-%d %H:%M') }}</small>
                    -->
                </div>
                {% endfor %}
            </div>

            <!-- Form to send a message -->
            <form action="/chat" method="post" class="mt-3">
                <input type="hidden" name="recipient_id" value="{{ recipient_id }}">
                <div class="input-group">
                    <input type="text" name="message" class="form-control" placeholder="Type your message..." required>
                    <button type="submit" class="btn btn-primary">Send</button>
            </form>
        </div>
        {% else %}
        <p>Select user to start chatting.</p>
        {% endif %}
    </div>
</div>
{% endblock %}